#=================================================#
#   ██████╗ ██████╗ ███╗   ███╗███████╗████████╗  #
#  ██╔════╝██╔═══██╗████╗ ████║██╔════╝╚══██╔══╝  #
#  ██║     ██║   ██║██╔████╔██║█████╗     ██║     #
#  ██║     ██║   ██║██║╚██╔╝██║██╔══╝     ██║     #
#  ╚██████╗╚██████╔╝██║ ╚═╝ ██║███████╗   ██║     #
#   ╚═════╝ ╚═════╝ ╚═╝     ╚═╝╚══════╝   ╚═╝     #
#=================================================#
#     CometNet Instance - Homelab Deployment      #
#=================================================#
#
# INSTRUCTIONS:
# 1. Copy this file to .env: cp .env.example .env
# 2. Replace all CHANGE_ME values with actual secrets
# 3. Never commit .env to version control
#
# NOTE: Default values are automatically loaded by Comet.
# Only uncomment and modify variables you need to change.
#

# ============================================== #
# DATABASE CREDENTIALS (Required for compose)   #
# ============================================== #
POSTGRES_USER=comet
POSTGRES_PASSWORD=set-password-here
POSTGRES_DB=comet

# ============================== #
# Stremio Addon Configuration    #
# ============================== #
ADDON_ID=stremio.comet.homelab
ADDON_NAME=Comet Homelab

# ============================== #
# FastAPI Server Configuration   #
# ============================== #
FASTAPI_HOST=0.0.0.0
FASTAPI_PORT=8000
# Single worker REQUIRED for CometNet Integrated Mode
FASTAPI_WORKERS=1
USE_GUNICORN=True
GUNICORN_PRELOAD_APP=True
# Max workers for CPU-intensive tasks. Keep low for weak CPUs.
EXECUTOR_MAX_WORKERS=1

# ============================== #
# Playback Settings              #
# ============================== #
# Optional: force playback URLs to use this public base
# Example: PUBLIC_BASE_URL=https://comet.example.com
PUBLIC_BASE_URL=

# ============================== #
# Dashboard Settings             #
# ============================== #
ADMIN_DASHBOARD_PASSWORD=set-password-here
PUBLIC_METRICS_API=False

# ============================== #
# Database Configuration         #
# ============================== #
# Database type is set in docker-compose.yml environment
# DATABASE_TYPE=postgresql
# DATABASE_URL is constructed from POSTGRES_* variables in docker-compose.yml
DATABASE_FORCE_IPV4_RESOLUTION=False
DATABASE_BATCH_SIZE=20000
#DATABASE_READ_REPLICA_URLS=
DATABASE_STARTUP_CLEANUP_INTERVAL=3600

# ============================== #
# Cache Settings (Seconds)       #
# ============================== #
METADATA_CACHE_TTL=2592000
TORRENT_CACHE_TTL=2592000
LIVE_TORRENT_CACHE_TTL=604800
DEBRID_CACHE_TTL=86400
DEBRID_CACHE_CHECK_RATIO=0.0
METRICS_CACHE_TTL=60
SCRAPE_LOCK_TTL=300
SCRAPE_WAIT_TIMEOUT=30

# ======================================================= #
# Background Scraper                                      #
# Zilean and no-ratelimit indexers/scrapers recommended!  #
# PostgreSQL recommended for high worker count!           #
# ======================================================= #
BACKGROUND_SCRAPER_ENABLED=False # Auto-start background scraper when Comet starts (manual start from admin UI still possible if False)
BACKGROUND_SCRAPER_CONCURRENT_WORKERS=2 # Number of concurrent workers for scraping (adjust depending on whether you are often ratelimited by scrapers)
BACKGROUND_SCRAPER_INTERVAL=3600 # Interval between scraping cycles in seconds
BACKGROUND_SCRAPER_MAX_MOVIES_PER_RUN=100 # Maximum number of movies to scrape per run
BACKGROUND_SCRAPER_MAX_SERIES_PER_RUN=100 # Maximum number of series to scrape per run
BACKGROUND_SCRAPER_SUCCESS_TTL=604800 # Successful scrape cooldown before re-scraping same media (seconds)
BACKGROUND_SCRAPER_FAILURE_BASE_BACKOFF=3600 # Initial retry delay for failed scrapes (seconds)
BACKGROUND_SCRAPER_FAILURE_MAX_BACKOFF=604800 # Maximum retry delay for failed scrapes (seconds)
BACKGROUND_SCRAPER_MAX_RETRIES=6 # Max consecutive failed attempts before marking item as dead
BACKGROUND_SCRAPER_RUN_TIME_BUDGET=1800 # Soft runtime budget for one run/cycle (seconds)
BACKGROUND_SCRAPER_DISCOVERY_MULTIPLIER=3 # Discover this multiplier * planned items each cycle
BACKGROUND_SCRAPER_MAX_EPISODES_PER_SERIES_PER_RUN=25 # Cap episodes scraped per series in one cycle
BACKGROUND_SCRAPER_EPISODE_REFRESH_TTL=21600 # Refresh known series episodes from Cinemeta when older than this TTL (seconds)
BACKGROUND_SCRAPER_ENABLE_DEMAND_PRIORITY=True # Prioritize items recently requested by users
BACKGROUND_SCRAPER_DEMAND_LOOKBACK=86400 # Recency window for demand boost from first_searches (seconds)
BACKGROUND_SCRAPER_DEFER_COOLDOWN=300 # Cooldown applied when item is deferred due run budget/cancel (seconds)
BACKGROUND_SCRAPER_MIN_PRIORITY_SCORE=0.0 # Skip low-priority discovered items below this threshold (unless recently demanded)
BACKGROUND_SCRAPER_PRIORITY_DECAY_ON_MISS=0.9 # Multiply item priority by this factor on misses (0<value<=1)
BACKGROUND_SCRAPER_ALERT_FAIL_RATE=0.7 # Degrade health when 24h fail rate exceeds this ratio
BACKGROUND_SCRAPER_ALERT_QUEUE_AGE=86400 # Degrade health when oldest queued item age exceeds this (seconds)
BACKGROUND_SCRAPER_RUN_RETENTION_DAYS=30 # Retention for run history table
CATALOG_TIMEOUT=30 # Max time to fetch catalog pages (seconds)

# ============================== #
# Anime Mapping Configuration    #
# ============================== #
ANIME_MAPPING_ENABLED=True
ANIME_MAPPING_REFRESH_INTERVAL=432000

# ============================== #
# Networking & Proxy             #
# ============================== #
GLOBAL_PROXY_URL=
PROXY_ETHOS=always
RATELIMIT_MAX_RETRIES=3
RATELIMIT_RETRY_BASE_DELAY=1.0

# ============================== #
# Jackett Configuration          #
# ============================== #
# Context mode: live, background, both, false
SCRAPE_JACKETT=Background
JACKETT_URL=http://192.168.1.75:9117
JACKETT_API_KEY='your-api-key-here'
JACKETT_INDEXERS=[]

# ============================== #
# Prowlarr Configuration         #
# ============================== #
SCRAPE_PROWLARR=False
PROWLARR_URL=http://192.168.1.75:9696
PROWLARR_API_KEY='your-api-key-here'
PROWLARR_INDEXERS=[]

# Shared Indexer Settings
INDEXER_MANAGER_TIMEOUT=30
INDEXER_MANAGER_WAIT_TIMEOUT=30
INDEXER_MANAGER_UPDATE_INTERVAL=900

# ============================== #
# Torrent Settings               #
# ============================== #
GET_TORRENT_TIMEOUT=5
DOWNLOAD_TORRENT_FILES=False
MAGNET_RESOLVE_TIMEOUT=60
DOWNLOAD_GENERIC_TRACKERS=False

# ============================== #
# Scraping Configuration         #
# ============================== #
# Context modes: true/both, live, background, false
# Multi-instance: use JSON array format

# Comet Scraper
SCRAPE_COMET=Background
COMET_URL='["https://comet.feels.legal", "https://cometfortheweebs.midnightignite.me", "https://comet.stremio.ru"]'
COMET_CLEAN_TRACKER=True

# Nyaa Scraper
SCRAPE_NYAA=Background
NYAA_ANIME_ONLY=True
NYAA_MAX_CONCURRENT_PAGES=5

# AnimeTosho Scraper
SCRAPE_ANIMETOSHO=Background
ANIMETOSHO_ANIME_ONLY=True
ANIMETOSHO_MAX_CONCURRENT_PAGES=10

# SeaDex Scraper
SCRAPE_SEADEX=Background # requires ANIME_MAPPING_ENABLED to be True
SEADEX_ANIME_ONLY=True # Only scrape SeaDex if the content is anime

SCRAPE_NEKOBT=Background
NEKOBT_ANIME_ONLY=True # Only scrape NekoBT if the content is anime

# Zilean Scraper
SCRAPE_ZILEAN=True
ZILEAN_URL='["http://192.168.1.75:8181","https://zileanfortheweebs.midnightignite.me", "https://zilean.stremio.ru"]'

# StremThru Scraper
SCRAPE_STREMTHRU=Background
STREMTHRU_SCRAPE_URL='["https://stremthru.1337001.xyz", "https://stremthrufortheweebs.midnightignite.me", "https://stremthru.elfhosted.com", "https://stremthrufortheweak.nhyira.dev", "https://stremthru.atbhosting.com", "https://stremthru.stremio.ru"]'

# DMM Scraper & Ingester
SCRAPE_DMM=Background
DMM_INGEST_ENABLED=True
DMM_INGEST_INTERVAL=86400
DMM_INGEST_CONCURRENT_WORKERS=4
DMM_INGEST_BATCH_SIZE=100

# Bitmagnet Scraper
SCRAPE_BITMAGNET=Background
BITMAGNET_URL=https://bitmagnetfortheweebs.midnightignite.me
BITMAGNET_MAX_CONCURRENT_PAGES=5
BITMAGNET_MAX_OFFSET=15000

# Torrentio Scraper
SCRAPE_TORRENTIO=Background
TORRENTIO_URL='["https://torrentio.strem.fun", "https://torrentio.stremio.ru"]'

# MediaFusion Scraper
SCRAPE_MEDIAFUSION=Background
MEDIAFUSION_URL='["https://mediafusion.stremio.ru", "https://mediafusionfortheweebs.midnightignite.me"]'
MEDIAFUSION_API_PASSWORD=
MEDIAFUSION_LIVE_SEARCH=True

# AIOStreams Scraper
SCRAPE_AIOSTREAMS=False
AIOSTREAMS_URL=https://aio.example.com
AIOSTREAMS_USER_UUID_AND_PASSWORD=user_uuid:password

# Jackettio Scraper
SCRAPE_JACKETTIO=False
JACKETTIO_URL=https://jackettio.example.com

# Debridio Scraper
SCRAPE_DEBRIDIO=False
DEBRIDIO_API_KEY=CHANGE_ME_DEBRIDIO_API_KEY
DEBRIDIO_PROVIDER=realdebrid
DEBRIDIO_PROVIDER_KEY=CHANGE_ME_DEBRIDIO_PROVIDER_KEY

# TorBox Scraper
SCRAPE_TORBOX=Background
TORBOX_API_KEY='your-torbox-key-here'

# Other Scrapers
SCRAPE_TORRENTSDB=Background
SCRAPE_PEERFLIX=Background

# ============================== #
# Debrid Stream Proxy Settings   #
# ============================== #
PROXY_DEBRID_STREAM=False
PROXY_DEBRID_STREAM_PASSWORD=CHANGE_ME_PROXY_PASSWORD
PROXY_DEBRID_STREAM_MAX_CONNECTIONS=-1
PROXY_DEBRID_STREAM_DEBRID_DEFAULT_SERVICE=realdebrid
PROXY_DEBRID_STREAM_DEBRID_DEFAULT_APIKEY=CHANGE_ME_DEBRID_API_KEY
PROXY_DEBRID_STREAM_INACTIVITY_THRESHOLD=300

# ============================== #
# Torrent Stream Policy          #
# ============================== #
DISABLE_TORRENT_STREAMS=True
TORRENT_DISABLED_STREAM_NAME=[INFO] Comet
TORRENT_DISABLED_STREAM_DESCRIPTION=Direct torrent playback is disabled on this server.
TORRENT_DISABLED_STREAM_URL=https://comet.feels.legal

# ============================== #
# Content Filtering              #
# ============================== #
REMOVE_ADULT_CONTENT=False
RTN_FILTER_DEBUG=False
SMART_LANGUAGE_DETECTION=False
DIGITAL_RELEASE_FILTER=False
TMDB_READ_ACCESS_TOKEN=

# ============================== #
# UI Customization               #
# ============================== #
CUSTOM_HEADER_HTML=

# ============================== #
# StremThru Integration          #
# ============================== #
STREMTHRU_URL=https://stremthru.13377001.xyz

# ============================== #
# HTTP Cache Settings            #
# ============================== #
HTTP_CACHE_ENABLED=False
HTTP_CACHE_STREAMS_TTL=300
HTTP_CACHE_STALE_WHILE_REVALIDATE=60
HTTP_CACHE_MANIFEST_TTL=86400
HTTP_CACHE_CONFIGURE_TTL=86400

# ============================================== #
#                                                #
#           COMETNET P2P CONFIGURATION           #
#                                                #
# ============================================== #

# === INTEGRATED MODE SETTINGS ===
# Enable CometNet P2P network (single instance only!)
COMETNET_ENABLED=True
# WebSocket port for incoming P2P connections
COMETNET_LISTEN_PORT=8765
# HTTP API port (only used by standalone service)
COMETNET_HTTP_PORT=8766

# === RELAY MODE SETTINGS (for clusters) ===
# URL of standalone CometNet service. When set, COMETNET_ENABLED is ignored.
COMETNET_RELAY_URL=
# API key for standalone service authentication
COMETNET_API_KEY=

# === NETWORK DISCOVERY ===
# Bootstrap nodes - public entry points to join the network
# Format: JSON array of WebSocket URLs
# Example: COMETNET_BOOTSTRAP_NODES='["wss://bootstrap1.example:8765"]'
COMETNET_BOOTSTRAP_NODES='["wss://cometnet.micasa161.me", "wss://cometnet.10001111.xyz", "wss://cometnetuk.sophnsharm.stream/cometnet/ws", "wss://cometuk2.sophnsharm.stream/cometnet/ws", "wss://cometnet.selfhosting.sterzeck.com.br", "wss://cometnet.thelair.qzz.io","wss://cometnet.streamproxy.xyz"]'

# Manual peers to connect to directly (trusted peers)
# Example: COMETNET_MANUAL_PEERS='["wss://friend.example.com:8765"]'
COMETNET_MANUAL_PEERS=[]

# === PEER MANAGEMENT ===
# Lowered for homelab with limited resources
COMETNET_MAX_PEERS=50
COMETNET_MIN_PEERS=5

# === IDENTITY & SECURITY ===
COMETNET_KEYS_DIR=data/cometnet
# Your public WebSocket URL via Cloudflare Tunnel (separate subdomain)
# Format: wss://cometnet.your-domain.com (direct WebSocket, no path routing)
COMETNET_ADVERTISE_URL=wss://cometnet.vasujain.me
# Optional friendly name for this node
COMETNET_NODE_ALIAS='vjslayer'
# Optional password to encrypt private key on disk
COMETNET_KEY_PASSWORD=

# === ADVANCED SETTINGS ===
# Allow private/internal IPs via Peer Exchange (for LAN setups)
COMETNET_ALLOW_PRIVATE_PEX=False
# Skip external reachability check (for local testing only)
COMETNET_SKIP_REACHABILITY_CHECK=False
# Skip system clock synchronization check
COMETNET_SKIP_TIME_CHECK=False
# Maximum allowed clock drift (seconds)
COMETNET_TIME_CHECK_TOLERANCE=60
# Timeout for time check request (seconds)
COMETNET_TIME_CHECK_TIMEOUT=5
# Periodic state save interval (seconds)
COMETNET_STATE_SAVE_INTERVAL=300
# Reachability check retries (increase for Cloudflare Tunnel)
COMETNET_REACHABILITY_RETRIES=10
COMETNET_REACHABILITY_RETRY_DELAY=15
COMETNET_REACHABILITY_TIMEOUT=15
# UPnP - DISABLE if behind CGNAT (won't work)
COMETNET_UPNP_ENABLED=False
COMETNET_UPNP_LEASE_DURATION=3600

# === GOSSIP TUNING (Advanced) ===
# Lower fanout for limited bandwidth
COMETNET_GOSSIP_FANOUT=2
COMETNET_GOSSIP_INTERVAL=1.0
COMETNET_GOSSIP_MESSAGE_TTL=5
COMETNET_GOSSIP_MAX_TORRENTS_PER_MESSAGE=1000
COMETNET_GOSSIP_VALIDATION_FUTURE_TOLERANCE=60
COMETNET_GOSSIP_VALIDATION_PAST_TOLERANCE=300
COMETNET_GOSSIP_TORRENT_MAX_AGE=604800

# === DISCOVERY TUNING (Advanced) ===
COMETNET_PEX_BATCH_SIZE=20
COMETNET_PEER_CONNECT_BACKOFF_MAX=300
COMETNET_PEER_MAX_FAILURES=5
COMETNET_PEER_CLEANUP_AGE=604800

# === TRANSPORT TUNING (Advanced) ===
COMETNET_TRANSPORT_MAX_MESSAGE_SIZE=10485760
COMETNET_TRANSPORT_MAX_CONNECTIONS_PER_IP=3
COMETNET_TRANSPORT_PING_INTERVAL=30.0
COMETNET_TRANSPORT_CONNECTION_TIMEOUT=120.0
COMETNET_TRANSPORT_MAX_LATENCY_MS=10000.0
COMETNET_TRANSPORT_RATE_LIMIT_ENABLED=True
COMETNET_TRANSPORT_RATE_LIMIT_COUNT=20
COMETNET_TRANSPORT_RATE_LIMIT_WINDOW=1.0

# === REPUTATION SYSTEM (Advanced) ===
COMETNET_REPUTATION_INITIAL=100.0
COMETNET_REPUTATION_MIN=0.0
COMETNET_REPUTATION_MAX=10000.0
COMETNET_REPUTATION_THRESHOLD_TRUSTED=1000.0
COMETNET_REPUTATION_THRESHOLD_UNTRUSTED=50.0
COMETNET_REPUTATION_BONUS_VALID_CONTRIBUTION=0.001
COMETNET_REPUTATION_BONUS_PER_DAY_ANCIENNETY=10.0
COMETNET_REPUTATION_BONUS_MAX_ANCIENNETY=1000.0
COMETNET_REPUTATION_PENALTY_INVALID_CONTRIBUTION=50.0
COMETNET_REPUTATION_PENALTY_SPAM_DETECTED=100.0
COMETNET_REPUTATION_PENALTY_INVALID_SIGNATURE=500.0

# === CONTRIBUTION MODE ===
# full: Share + receive + repropagate (recommended)
# consumer: Receive + repropagate, don't share own
# source: Share only, don't receive
# leech: Receive only, don't repropagate
COMETNET_CONTRIBUTION_MODE=full

# === TRUST POOLS ===
# Leave empty for open mode (accept from everyone)
# Example: COMETNET_TRUSTED_POOLS='["trusted-community"]'
COMETNET_TRUSTED_POOLS=[]
COMETNET_POOLS_DIR=data/cometnet/pools

# === PRIVATE NETWORK ===
COMETNET_PRIVATE_NETWORK=False
# Unique identifier for private network (required if PRIVATE_NETWORK=True)
COMETNET_NETWORK_ID=
# Password to join private network (shared secret)
COMETNET_NETWORK_PASSWORD=
# Pools to ingest from public network even in private mode
COMETNET_INGEST_POOLS=[]
