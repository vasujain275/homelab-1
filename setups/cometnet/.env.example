#=================================================#
#   ██████╗ ██████╗ ███╗   ███╗███████╗████████╗  #
#  ██╔════╝██╔═══██╗████╗ ████║██╔════╝╚══██╔══╝  #
#  ██║     ██║   ██║██╔████╔██║█████╗     ██║     #
#  ██║     ██║   ██║██║╚██╔╝██║██╔══╝     ██║     #
#  ╚██████╗╚██████╔╝██║ ╚═╝ ██║███████╗   ██║     #
#   ╚═════╝ ╚═════╝ ╚═╝     ╚═╝╚══════╝   ╚═╝     #
#=================================================#
#     CometNet Instance - Homelab Deployment      #
#=================================================#
#
# INSTRUCTIONS:
# 1. Copy this file to .env: cp .env.example .env
# 2. Replace all CHANGE_ME values with actual secrets
# 3. Never commit .env to version control
#
# NOTE: Default values are automatically loaded by Comet.
# Only uncomment and modify variables you need to change.
#

# ============================================== #
# DATABASE CREDENTIALS (Required for compose)   #
# ============================================== #
POSTGRES_USER=comet
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD
POSTGRES_DB=comet

# ============================== #
# Stremio Addon Configuration    #
# ============================== #
ADDON_ID=stremio.comet.homelab
ADDON_NAME=Comet Homelab

# ============================== #
# FastAPI Server Configuration   #
# ============================== #
FASTAPI_HOST=0.0.0.0
FASTAPI_PORT=8000
# Single worker REQUIRED for CometNet Integrated Mode
FASTAPI_WORKERS=1
USE_GUNICORN=True
GUNICORN_PRELOAD_APP=True
# Max workers for CPU-intensive tasks. Keep low for weak CPUs.
EXECUTOR_MAX_WORKERS=1

# ============================== #
# Playback Settings              #
# ============================== #
# Optional: force playback URLs to use this public base
# Example: PUBLIC_BASE_URL=https://comet.example.com
PUBLIC_BASE_URL=

# ============================== #
# Dashboard Settings             #
# ============================== #
ADMIN_DASHBOARD_PASSWORD=CHANGE_ME_ADMIN_PASSWORD
PUBLIC_METRICS_API=False

# ============================== #
# Database Configuration         #
# ============================== #
# Database type is set in docker-compose.yml environment
# DATABASE_TYPE=postgresql
# DATABASE_URL is constructed from POSTGRES_* variables in docker-compose.yml
DATABASE_FORCE_IPV4_RESOLUTION=False
DATABASE_BATCH_SIZE=20000
DATABASE_READ_REPLICA_URLS=
DATABASE_STARTUP_CLEANUP_INTERVAL=3600

# ============================== #
# Cache Settings (Seconds)       #
# ============================== #
METADATA_CACHE_TTL=2592000
TORRENT_CACHE_TTL=2592000
LIVE_TORRENT_CACHE_TTL=604800
DEBRID_CACHE_TTL=86400
DEBRID_CACHE_CHECK_RATIO=0.0
METRICS_CACHE_TTL=60
SCRAPE_LOCK_TTL=300
SCRAPE_WAIT_TIMEOUT=30

# ============================== #
# Background Scraper             #
# ============================== #
BACKGROUND_SCRAPER_ENABLED=False
BACKGROUND_SCRAPER_CONCURRENT_WORKERS=1
BACKGROUND_SCRAPER_INTERVAL=3600
BACKGROUND_SCRAPER_MAX_MOVIES_PER_RUN=100
BACKGROUND_SCRAPER_MAX_SERIES_PER_RUN=100
CATALOG_TIMEOUT=30

# ============================== #
# Anime Mapping Configuration    #
# ============================== #
ANIME_MAPPING_ENABLED=True
ANIME_MAPPING_REFRESH_INTERVAL=432000

# ============================== #
# Networking & Proxy             #
# ============================== #
GLOBAL_PROXY_URL=
PROXY_ETHOS=always
RATELIMIT_MAX_RETRIES=3
RATELIMIT_RETRY_BASE_DELAY=1.0

# ============================== #
# Jackett Configuration          #
# ============================== #
# Context mode: live, background, both, false
SCRAPE_JACKETT=False
JACKETT_URL=http://127.0.0.1:9117
JACKETT_API_KEY=CHANGE_ME_JACKETT_API_KEY
JACKETT_INDEXERS=[]

# ============================== #
# Prowlarr Configuration         #
# ============================== #
SCRAPE_PROWLARR=False
PROWLARR_URL=http://127.0.0.1:9696
PROWLARR_API_KEY=CHANGE_ME_PROWLARR_API_KEY
PROWLARR_INDEXERS=[]

# Shared Indexer Settings
INDEXER_MANAGER_TIMEOUT=30
INDEXER_MANAGER_WAIT_TIMEOUT=30
INDEXER_MANAGER_UPDATE_INTERVAL=900

# ============================== #
# Torrent Settings               #
# ============================== #
GET_TORRENT_TIMEOUT=5
DOWNLOAD_TORRENT_FILES=False
MAGNET_RESOLVE_TIMEOUT=60
DOWNLOAD_GENERIC_TRACKERS=False

# ============================== #
# Scraping Configuration         #
# ============================== #
# Context modes: true/both, live, background, false
# Multi-instance: use JSON array format

# Comet Scraper
SCRAPE_COMET=False
COMET_URL=https://comet.feels.legal
COMET_CLEAN_TRACKER=False

# Nyaa Scraper
SCRAPE_NYAA=False
NYAA_ANIME_ONLY=True
NYAA_MAX_CONCURRENT_PAGES=5

# AnimeTosho Scraper
SCRAPE_ANIMETOSHO=False
ANIMETOSHO_ANIME_ONLY=True
ANIMETOSHO_MAX_CONCURRENT_PAGES=10

# Zilean Scraper
SCRAPE_ZILEAN=False
ZILEAN_URL=https://zileanfortheweebs.midnightignite.me

# StremThru Scraper
SCRAPE_STREMTHRU=False
STREMTHRU_SCRAPE_URL=https://stremthru.13377001.xyz

# DMM Scraper & Ingester
SCRAPE_DMM=False
DMM_INGEST_ENABLED=False
DMM_INGEST_INTERVAL=86400
DMM_INGEST_CONCURRENT_WORKERS=4
DMM_INGEST_BATCH_SIZE=100

# Bitmagnet Scraper
SCRAPE_BITMAGNET=False
BITMAGNET_URL=https://bitmagnetfortheweebs.midnightignite.me
BITMAGNET_MAX_CONCURRENT_PAGES=5
BITMAGNET_MAX_OFFSET=15000

# Torrentio Scraper
SCRAPE_TORRENTIO=False
TORRENTIO_URL=https://torrentio.strem.fun

# MediaFusion Scraper
SCRAPE_MEDIAFUSION=False
MEDIAFUSION_URL=https://mediafusion.elfhosted.com
MEDIAFUSION_API_PASSWORD=
MEDIAFUSION_LIVE_SEARCH=True

# AIOStreams Scraper
SCRAPE_AIOSTREAMS=False
AIOSTREAMS_URL=https://aio.example.com
AIOSTREAMS_USER_UUID_AND_PASSWORD=user_uuid:password

# Jackettio Scraper
SCRAPE_JACKETTIO=False
JACKETTIO_URL=https://jackettio.example.com

# Debridio Scraper
SCRAPE_DEBRIDIO=False
DEBRIDIO_API_KEY=CHANGE_ME_DEBRIDIO_API_KEY
DEBRIDIO_PROVIDER=realdebrid
DEBRIDIO_PROVIDER_KEY=CHANGE_ME_DEBRIDIO_PROVIDER_KEY

# TorBox Scraper
SCRAPE_TORBOX=False
TORBOX_API_KEY=CHANGE_ME_TORBOX_API_KEY

# Other Scrapers
SCRAPE_TORRENTSDB=False
SCRAPE_PEERFLIX=False

# ============================== #
# Debrid Stream Proxy Settings   #
# ============================== #
PROXY_DEBRID_STREAM=False
PROXY_DEBRID_STREAM_PASSWORD=CHANGE_ME_PROXY_PASSWORD
PROXY_DEBRID_STREAM_MAX_CONNECTIONS=-1
PROXY_DEBRID_STREAM_DEBRID_DEFAULT_SERVICE=realdebrid
PROXY_DEBRID_STREAM_DEBRID_DEFAULT_APIKEY=CHANGE_ME_DEBRID_API_KEY
PROXY_DEBRID_STREAM_INACTIVITY_THRESHOLD=300

# ============================== #
# Torrent Stream Policy          #
# ============================== #
DISABLE_TORRENT_STREAMS=False
TORRENT_DISABLED_STREAM_NAME=[INFO] Comet
TORRENT_DISABLED_STREAM_DESCRIPTION=Direct torrent playback is disabled on this server.
TORRENT_DISABLED_STREAM_URL=https://comet.feels.legal

# ============================== #
# Content Filtering              #
# ============================== #
REMOVE_ADULT_CONTENT=False
RTN_FILTER_DEBUG=False
SMART_LANGUAGE_DETECTION=False
DIGITAL_RELEASE_FILTER=False
TMDB_READ_ACCESS_TOKEN=

# ============================== #
# UI Customization               #
# ============================== #
CUSTOM_HEADER_HTML=

# ============================== #
# StremThru Integration          #
# ============================== #
STREMTHRU_URL=https://stremthru.13377001.xyz

# ============================== #
# HTTP Cache Settings            #
# ============================== #
HTTP_CACHE_ENABLED=False
HTTP_CACHE_STREAMS_TTL=300
HTTP_CACHE_STALE_WHILE_REVALIDATE=60
HTTP_CACHE_MANIFEST_TTL=86400
HTTP_CACHE_CONFIGURE_TTL=86400

# ============================================== #
#                                                #
#           COMETNET P2P CONFIGURATION           #
#                                                #
# ============================================== #

# === INTEGRATED MODE SETTINGS ===
# Enable CometNet P2P network (single instance only!)
COMETNET_ENABLED=True
# WebSocket port for incoming P2P connections
COMETNET_LISTEN_PORT=8765
# HTTP API port (only used by standalone service)
COMETNET_HTTP_PORT=8766

# === RELAY MODE SETTINGS (for clusters) ===
# URL of standalone CometNet service. When set, COMETNET_ENABLED is ignored.
COMETNET_RELAY_URL=
# API key for standalone service authentication
COMETNET_API_KEY=

# === NETWORK DISCOVERY ===
# Bootstrap nodes - public entry points to join the network
# Format: JSON array of WebSocket URLs
# Example: COMETNET_BOOTSTRAP_NODES='["wss://bootstrap1.example:8765"]'
COMETNET_BOOTSTRAP_NODES=[]

# Manual peers to connect to directly (trusted peers)
# Example: COMETNET_MANUAL_PEERS='["wss://friend.example.com:8765"]'
COMETNET_MANUAL_PEERS=[]

# === PEER MANAGEMENT ===
# Lowered for homelab with limited resources
COMETNET_MAX_PEERS=25
COMETNET_MIN_PEERS=3

# === IDENTITY & SECURITY ===
COMETNET_KEYS_DIR=data/cometnet
# Your public WebSocket URL via Cloudflare Tunnel (separate subdomain)
# Format: wss://cometnet.your-domain.com (direct WebSocket, no path routing)
COMETNET_ADVERTISE_URL=wss://cometnet.vasujain.me
# Optional friendly name for this node
COMETNET_NODE_ALIAS=
# Optional password to encrypt private key on disk
COMETNET_KEY_PASSWORD=

# === ADVANCED SETTINGS ===
# Allow private/internal IPs via Peer Exchange (for LAN setups)
COMETNET_ALLOW_PRIVATE_PEX=False
# Skip external reachability check (for local testing only)
COMETNET_SKIP_REACHABILITY_CHECK=False
# Skip system clock synchronization check
COMETNET_SKIP_TIME_CHECK=False
# Maximum allowed clock drift (seconds)
COMETNET_TIME_CHECK_TOLERANCE=60
# Timeout for time check request (seconds)
COMETNET_TIME_CHECK_TIMEOUT=5
# Periodic state save interval (seconds)
COMETNET_STATE_SAVE_INTERVAL=300
# Reachability check retries (increase for Cloudflare Tunnel)
COMETNET_REACHABILITY_RETRIES=10
COMETNET_REACHABILITY_RETRY_DELAY=15
COMETNET_REACHABILITY_TIMEOUT=15
# UPnP - DISABLE if behind CGNAT (won't work)
COMETNET_UPNP_ENABLED=False
COMETNET_UPNP_LEASE_DURATION=3600

# === GOSSIP TUNING (Advanced) ===
# Lower fanout for limited bandwidth
COMETNET_GOSSIP_FANOUT=2
COMETNET_GOSSIP_INTERVAL=1.0
COMETNET_GOSSIP_MESSAGE_TTL=5
COMETNET_GOSSIP_MAX_TORRENTS_PER_MESSAGE=1000
COMETNET_GOSSIP_VALIDATION_FUTURE_TOLERANCE=60
COMETNET_GOSSIP_VALIDATION_PAST_TOLERANCE=300
COMETNET_GOSSIP_TORRENT_MAX_AGE=604800

# === DISCOVERY TUNING (Advanced) ===
COMETNET_PEX_BATCH_SIZE=20
COMETNET_PEER_CONNECT_BACKOFF_MAX=300
COMETNET_PEER_MAX_FAILURES=5
COMETNET_PEER_CLEANUP_AGE=604800

# === TRANSPORT TUNING (Advanced) ===
COMETNET_TRANSPORT_MAX_MESSAGE_SIZE=10485760
COMETNET_TRANSPORT_MAX_CONNECTIONS_PER_IP=3
COMETNET_TRANSPORT_PING_INTERVAL=30.0
COMETNET_TRANSPORT_CONNECTION_TIMEOUT=120.0
COMETNET_TRANSPORT_MAX_LATENCY_MS=10000.0
COMETNET_TRANSPORT_RATE_LIMIT_ENABLED=True
COMETNET_TRANSPORT_RATE_LIMIT_COUNT=20
COMETNET_TRANSPORT_RATE_LIMIT_WINDOW=1.0

# === REPUTATION SYSTEM (Advanced) ===
COMETNET_REPUTATION_INITIAL=100.0
COMETNET_REPUTATION_MIN=0.0
COMETNET_REPUTATION_MAX=10000.0
COMETNET_REPUTATION_THRESHOLD_TRUSTED=1000.0
COMETNET_REPUTATION_THRESHOLD_UNTRUSTED=50.0
COMETNET_REPUTATION_BONUS_VALID_CONTRIBUTION=0.001
COMETNET_REPUTATION_BONUS_PER_DAY_ANCIENNETY=10.0
COMETNET_REPUTATION_BONUS_MAX_ANCIENNETY=1000.0
COMETNET_REPUTATION_PENALTY_INVALID_CONTRIBUTION=50.0
COMETNET_REPUTATION_PENALTY_SPAM_DETECTED=100.0
COMETNET_REPUTATION_PENALTY_INVALID_SIGNATURE=500.0

# === CONTRIBUTION MODE ===
# full: Share + receive + repropagate (recommended)
# consumer: Receive + repropagate, don't share own
# source: Share only, don't receive
# leech: Receive only, don't repropagate
COMETNET_CONTRIBUTION_MODE=full

# === TRUST POOLS ===
# Leave empty for open mode (accept from everyone)
# Example: COMETNET_TRUSTED_POOLS='["trusted-community"]'
COMETNET_TRUSTED_POOLS=[]
COMETNET_POOLS_DIR=data/cometnet/pools

# === PRIVATE NETWORK ===
COMETNET_PRIVATE_NETWORK=False
# Unique identifier for private network (required if PRIVATE_NETWORK=True)
COMETNET_NETWORK_ID=
# Password to join private network (shared secret)
COMETNET_NETWORK_PASSWORD=
# Pools to ingest from public network even in private mode
COMETNET_INGEST_POOLS=[]
